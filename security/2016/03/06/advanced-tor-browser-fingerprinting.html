<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Advanced Tor Browser Fingerprinting</title>
	
	<meta name="author" content="Jose Carlos Norte">

	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="/assets/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="/assets/resources/syntax/syntax.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">

	<!-- Le fav and touch icons -->
	<!-- Update these with your own images
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	-->

	<link rel="alternate" type="application/rss+xml" title="" href="/feed.xml">
</head>

<body>
	<nav class="navbar navbar-default visible-xs" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			
			<a type="button" class="navbar-toggle nav-link" href="http://github.com/jcarlosn">
				<i class="fa fa-github"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/jcarlosnorte">
				<i class="fa fa-twitter"></i>
			</a>
			
			
			<a type="button" class="navbar-toggle nav-link" href="mailto:jcarlos.norte@gmail.com">
				<i class="fa fa-envelope"></i>
			</a>
			
			<a class="navbar-brand" href="/">
				<img src="http://www.gravatar.com/avatar/726351295ec82e145928582f595aa3aa?s=35" class="img-circle" />
				
			</a>
		</div>

		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav">
				<li class="active"><a href="/">Home</a></li>
				<li><a href="/categories.html">Categories</a></li>
				<li><a href="/tags.html">Tags</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</nav>

	<!-- nav-menu-dropdown -->
	<div class="btn-group hidden-xs" id="nav-menu">
		<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
			<i class="fa fa-bars"></i>
		</button>
		<ul class="dropdown-menu" role="menu">
			<li><a href="/"><i class="fa fa-home"></i>Home</a></li>
			<li><a href="/categories.html"><i class="fa fa-folder"></i>Categories</a></li>
			<li><a href="/tags.html"><i class="fa fa-tags"></i>Tags</a></li>
			<li class="divider"></li>
			<li><a href="#"><i class="fa fa-arrow-up"></i>Top of Page</a></li>
		</ul>
	</div>

	<div class="col-sm-3 sidebar hidden-xs" style="">
		<!-- sidebar.html -->
<header class="sidebar-header" role="banner">
	<a href="/">
		<img src="/assets/media/jcarlosn.png" class="img-circle" />
	</a>
	<h3 class="title">
        <a href="/"></a>
    </h3>
</header>


<div id="bio" class="text-center">
	Enterpreneur, Thinker, Agilist, Technology enthusiast, Computer programmer, I.T. security expert and FOSS supporter.
</div>


<div id="contact-list" class="text-center">
	<ul class="list-unstyled list-inline">
		
		<li>
			<a class="btn btn-default btn-sm" href="https://github.com/jcarlosn">
				<i class="fa fa-github-alt fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://twitter.com/jcarlosnorte">
				<i class="fa fa-twitter fa-lg"></i>
			</a>
		</li>
		
		
		<li>
			<a class="btn btn-default btn-sm" href="mailto:jcarlos.norte@gmail.com">
				<i class="fa fa-envelope fa-lg"></i>
			</a>
		</li>
		
	</ul>
	<ul id="contact-list-secondary" class="list-unstyled list-inline">
		
		
		<li>
			<a class="btn btn-default btn-sm" href="https://linkedin.com/in/jcarlosn">
				<i class="fa fa-linkedin fa-lg"></i>
			</a>
		</li>
		
		<li>
			<a class="btn btn-default btn-sm" href="/feed.xml">
				<i class="fa fa-rss fa-lg"></i>
			</a>
		</li>
	</ul>
</div>
<!-- sidebar.html end -->

	</div>

	<div class="col-sm-9 col-sm-offset-3">
		<div class="page-header">
  <h1>Advanced Tor Browser Fingerprinting </h1>
</div>
	
<article>

	<div class="col-sm-10">
	 <span class="post-date">
	   
	   March 
	   6th,
	   
	   2016
	 </span>
	  <div class="article_body">
	  <h3 id="tor-browser">Tor Browser</h3>

<p>The ability to privately communicate through the internet is very important for dissidents living under authoritary regimes,
activists and basically everyone concerned about internet privacy.</p>

<p>While the <a href="https://www.torproject.org/"><strong>TOR</strong></a> network itself provides a good level of privacy, making difficult or even practically impossible
to discover the real I.P. address of the tor users, this is by no means enough to protect users privacy on the web. When browsing the web,
your identity can be discovered using browser exploits, cookies, browser history, browser plugins, etc.</p>

<p><strong><a href="https://www.torproject.org/projects/torbrowser.html">Tor browser</a></strong> is a firefox browser preconfigured and modified
to protect user privacy and identity while browsing the web using TOR. Browser plugins are disabled, history and cache aren’t persistent
and everything is erased after closing the browser, etc.</p>

<h3 id="the-user-fingerprinting-problem">The user fingerprinting problem</h3>

<p>While preventing users IP address to be disclosed is a key aspect for protecting their privacy, a lot of other things need
to be taken into consideration. Tor browser is preconfigured to prevent a lot of possible attacks on user privacy, not only
the communications layer provided by tor itself.</p>

<p>One common problem that tor browser tries to address is user fingerprinting. If a website is able to generate a unique
fingerprint that identifies each user that enters the page, then it is possible to track the activity of this user
in time, for example, correlate visits of the user during an entire year, knowing that its the same user.</p>

<p>Or even worse, <strong>it could be possible to identify the user if the fingerprint is the same in tor browser and in the normal
browser used to browse internet</strong>. It is very important for the tor browser to prevent any attempt on fingerprinting the user.</p>

<div style="text-align:center;margin:25px">
<img src="/assets/media/posts/digital_fingerprint_small.png" />
</div>

<p>In the past, a lot of fingerprinting methods has been used and proposed and tor browser has been updated with countermeasures.
Examples of that are reading text sizes out of a canvas element, screen dimensions, local time, operating system information, etc.</p>

<p>One famous example of browser fingerprinting was <strong><a href="https://en.wikipedia.org/wiki/Canvas_fingerprinting">Canvas fingerprinting</a></strong>.
As of today, almost everything that can be used to identify the user has been disabled in tor browser.</p>

<h3 id="ubercookie">UberCookie</h3>

<p>During the last weeks I have been able to fingerprint tor browser users in controlled environments and I think it could be interesting
to share all the findings for further discussion and to improve tor browser.</p>

<p>All the provided fingerprinting methods are based on javascript (enabled by default in tor browser as of today). I have created a quick and dirty
PoC called UberCookie available as a demo here:</p>

<p><strong><a href="/assets/ubercookie/">Try ubercookie</a></strong></p>

<h3 id="measuring-time">Measuring time</h3>

<p>One interesting countermeasure for fingerprint implemented in tor browser is that javascript Date.getTime() (unix time) only updated each 100ms. So you can’t measure
events happening under 100ms. This is useful to prevent a javascript inside a webpage to measure events in order to fingerprint the user. Since for some of the things
I wanted to try needed better time accuracy than 100ms, this was the first thing to bypass.</p>

<p>There are a lot of ways to measure times smaller than 100ms using javascript in tor browser, some are obvious, or ther are intersting.</p>

<p>The first one I implemented was simply increment a variable by 1 each millisecond using setInterval. Even if the precision is not at milisecond level,
is extremly better than the 100ms accuracy provided by Date.getTime.</p>

<p>Another way you can use to measure time is to create an animation in CSS3, configured at 1ms interval and listen to the animationiteration event.</p>

<p>However, the better accuracy I could achieve was using setInterval incrementing inside a webworker.</p>

<h3 id="mouse-wheel-fingerprinting">Mouse wheel fingerprinting</h3>

<p>The mouse wheel event in Tor Browser (and most browsers) leaks information of the underlying hardware used to scroll the webpage.
The event provides information about the delta scrolled, however if you are using a normal computer mouse with a mouse wheel, the delta is always three, but
if you are using a trackpad, the deltas are variable and related to your trackpad and your usage patterns.</p>

<div style="text-align:center;margin:25px">
<img src="/assets/media/posts/mousehweel.png" />
</div>

<p>Another leak in the mouse wheel, is the scroll speed that is linked to the configuration of the operating system and the
hardware capabilities itself.</p>

<p>I have created a little experiment as a proof of concept, available here:</p>

<p><strong><a href="/assets/fingerprint/">Mouse wheel information leak demo</a></strong></p>

<p>This demo creates three graphs, one with the scrolling speed, another with the scrolling delta, and another one with the number
of times the user scrolled in the red box.</p>

<h3 id="mouse-speed-fingerprinting">Mouse Speed fingerprinting</h3>

<p>Another interesting fingerprint that could reveal some entropy is the speed of the mouse moving acrross the webpage. Since the
speed of the mouse is controlled by the operating system and related to hardware, and can be read using javascript if you can measure time
using the mentioned strategies.</p>

<p>It could be interesting also to measure average mouse speed while the user is in the page moving the mouse.</p>

<h3 id="cpu-benchmark-fingerprinting">CPU Benchmark fingerprinting</h3>

<p>With the improved accuracy on time provided by the setInterval inside the WebWorker, it is easy to create a CPU intensive
script (or even memory intensive) and measure how long it takes for the user browser to execute it.</p>

<p>I have done some tests with different computers, getting completely different results, all of them using the same tor browser
version.</p>

<h3 id="getclientrects-fingerprinting">getClientRects fingerprinting</h3>

<p>The most intersting fingerprinting vector I found on Tor Browser is <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getClientRects">getClientRects</a>.
Is strange that reading back from a canvas has been prevented but simply asking the browser javascript API how a specific DOM elements has been drawn on the screen
has not been prevented or protected in any way.</p>

<p>getClientRects allows to get the exact pixel position and size of the box of a given DOM element. Depending on the resolution, font configuration and lots of other factors,
the results of getClientRects are different, allowing for a very quick and easy fingerprinting vector, even better than the canvas fingerprinting that is fixed.</p>

<p>Example of getClientRects on the same page with same Tor Browser version on different computers:</p>

<p>Computer 1:</p>

<div style="text-align:center;margin:25px">
<img src="/assets/media/posts/rect1.png" />
</div>

<p>Computer 2:</p>

<div style="text-align:center;margin:25px">
<img src="/assets/media/posts/rect2.png" />
</div>

<p>As you can see, there is a lof of difference in the results of getClientRects between two computers using the same tor browser on the same page
and on the same DOM Element.</p>

<h3 id="results">Results</h3>

<p>An example of running ubercookie PoC in one computer (computer 1):</p>

<pre><code>Client rects: {"x":131.5,"y":462,"width":724,"height":19,"top":462,"right":855.5,"bottom":481,"left":131.5}

scrolling milis: [2,2,0,3,0,1,0,2,3,0,0,3,1,2,2,1,2,1,4,4,35,2,1,3,0,1,0,3,0,1,0,3,0,1,0,3,1,0,3,1,3,0,1,3,2,4,4,8,44,4,1,4,4,405,2,3,2,1,3,1,3,57,2,0,2,2,0,2,2,4,60,2,0,2,2,0,2,2,6,54,2,2,2,0,2,1,4,8]

scrolling deltas: [3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]

Biggest mouse step: 65

In a few seconds, the result of the CPU benchmark will appear, please wait...

CPU Mean: 3245
</code></pre>

<p>And the result of running it in a different computer (computer 2), same Tor browser version:</p>

<pre><code>Client rects: {"x":159.51666259765625,"y":465.25,"width":664.6500244140625,"height":18.449996948242188,"top":465.25,"right":824.1666870117188,"bottom":483.6999969482422,"left":159.51666259765625}

scrolling milis: [0,3,0,2,2,2,2,0,3,0,2,1,2,2,1,3,1,1,4,1,2,1,1,3,1,2,2,3,2,5,3,3,5,3,0,0,2,0,2,0,1,1,0,2,0,3,2,1,1,3,1,3,2,3,1,3,2,2,2,2,0,2,3,2,2,2,244,0,2,1,2,1,3,2,0,2,0,1,2,1,0,2,0,3,1,0,2,1,1,1,2,1,1,1,1,1,1,2,2,1,2,2,2,2,1,4,2,2,2,2,2,4,2]

scrolling deltas: [3,0.975,1.65,1.5,1.725,2.25,2.775,2.4,3.15,3.375,3.975,3.675,4.35,4.95,5.625,5.55,5.25,5.25,4.2,6.3,9.975,13.95,7.575,6.9,2.85,5.925,8.85,0.9,4.425,3.675,4.725,2.625,2.4,5.475,2.625,3.675,5.4,5.775,7.275,6.975,8.175,9,8.475,3.45,2.475,2.25,0.6,1.8,11.1,8.4,8.475,8.1,7.5,6.375,8.175,4.95,4.8,4.275,3.525,3.375,1.125,2.7,2.175,1.95,1.65,1.2,1.05,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]

Biggest mouse step: 40

In a few seconds, the result of the CPU benchmark will appear, please wait...

CPU Mean: 4660.5
</code></pre>

<p>It is evident that the getClientRects are completly different, providing an interesting fingerprinting vector.
The scrolling speed (milis) is also different.
The scrolling deltas are very different, because of hardware differences. The mouse of computer 1 is faster, as you can see in ‘biggest mouse step’.
The CPU benchmark provides different results, computer 1 being faster than computer 2.</p>

<h3 id="conclusion">Conclusion</h3>

<p>It is easy to fingerprint users using tor browser to track their activity online and correlate their visits to different pages.
getClientrects provides a very interesting vector for fingerprinting TOR Browser users. The CPU benchmark and the Mouse wheel and mouse speed
methods provide even more information to distinguish between similar users.</p>


	  </div>

		
		<ul class="tag_box list-unstyled list-inline">
		  <li><i class="fa fa-folder-open"></i></li>
		  
		  
			 
				<li><a href="/categories.html#security-ref">
					security <span>(3)</span>
					
				</a></li>
			
		  
		</ul>
		  

		
		<ul class="list-inline">
		  <li><i class="fa fa-tags"></i></li>
		  
		  
			 
				<li>
					<a href="/tags.html#security-ref">
					security <span>(3)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#tor-ref">
					tor <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#privacy-ref">
					privacy <span>(2)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#fingerprinting-ref">
					fingerprinting <span>(1)</span>
					,
					</a>
				</li>
			 
				<li>
					<a href="/tags.html#tbb-ref">
					tbb <span>(1)</span>
					
					</a>
				</li>
			
		  
		  
		</ul>
		  

		<hr>

		<div>
      <section class="share col-sm-6">
        <h4 class="section-title">Share Post</h4>
        <a class="btn btn-default btn-sm twitter" href="http://twitter.com/share?text=Advanced Tor Browser Fingerprinting&via=jcarlosnorte"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="fa fa-twitter fa-lg"></i>
          Twitter
        </a>
        <a class="btn btn-default btn-sm facebook" href="https://www.facebook.com/sharer/sharer.php"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="fa fa-facebook fa-lg"></i>
          Facebook
        </a>
        <a class="btn btn-default btn-sm gplus"
           onclick="window.open('https://plus.google.com/share?url='+window.location.href, 'google-plus-share', 'width=490,height=530');return false;">
          <i class="fa fa-google-plus fa-lg"></i>
          Google+
        </a>
      </section>

      <section class="col-sm-6 author">
        <img src="/assets/media/jcarlosn.png" class="img-rounded author-image" />
        <h4 class="section-title author-name">Jose Carlos Norte</h4>
        <p class="author-bio">Enterpreneur, Thinker, Agilist, Technology enthusiast, Computer programmer, I.T. security expert and FOSS supporter.</p>
      </section>
    </div>

    <div class="clearfix"></div>

		<ul class="pager">
		  
		  <li class="previous"><a href="/security/2016/02/21/date-leak-gzip-tor.html" title="HTTP GZIP Compression remote date and time leak">&larr; Previous</a></li>
		  
		  
		  <li class="next"><a href="/security/2016/03/06/hacking-tachographs-from-the-internets.html" title="Hacking industrial vehicles from the internet">Next &rarr;</a></li>
		  
		</ul>

		<hr>
	</div>
	
	<div class="col-sm-2 sidebar-2">

	</div>
</article>
<div class="clearfix"></div>



    
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jcarlosn';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>





		<footer>
			<hr/>
			<p>
				&copy; 2016 Jose Carlos Norte
			</p>
		</footer>
	</div>

	<script type="text/javascript" src="/assets/resources/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/resources/bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/assets/js/app.js"></script>
</body>
</html>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74110846-1', 'auto');
  ga('send', 'pageview');

</script>

